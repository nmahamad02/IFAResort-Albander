<div class="container">
    <div class="col-12">
        <div class="row">
            <div class="col-2">
                <mat-card-title>Agreements</mat-card-title>  
            </div>
            <div class="col-10">
                <div class="row">
                    <div class="col">
                        <button class="btn btn-block" (click)="viewHelp()" title="View Help" style="float:right">
                          <mat-icon>help_outline</mat-icon>
                        </button>
                    </div>
                    <div class="col">
                        <button class="btn-primary btn btn-block" (click)="newForm()" title="New Agreement">
                            <mat-icon>add</mat-icon>
                        </button>
                    </div>
                    <div class="col">
                        <button class="btn-warning btn text-white btn-block" (click)="goToInvoice()" title="View Invoice">
                            <mat-icon>note_add</mat-icon> 
                        </button>
                    </div>
                    <div class="col">
                        <button class="btn-secondary btn btn-block" [routerLinkActive]="['active']" [routerLink]="['/crm/invoicereport']" (click)="setReportData(invReportApiUrl, invReportName)" title="Print this Agreement">  
                            <mat-icon>print</mat-icon>
                        </button>
                    </div>
                    <div class="col">
                        <button class="btn-success btn btn-block" (click)="onFormSubmit()" title="Submit Agreement">
                            <mat-icon>note_add</mat-icon>  
                        </button>
                    </div>
                    <div class="col">
                        <button class="btn-success btn btn-block" (click)="convertToInvoice()" title="Convert to Invoice">
                            <mat-icon>arrow_circle_right</mat-icon>  
                        </button>
                    </div>
                    <div class="col">
                        <button class="btn-info btn text-white btn-block" title="Cancel this Agreement">
                            <mat-icon>delete</mat-icon> 
                        </button>
                    </div>
                    <div class="col">
                        <button class="btn-danger btn btn-block" (click)="refreshForm()" title="Refresh this form">
                            <mat-icon>cancel</mat-icon> 
                        </button>
                    </div>
                    <div class="col">
                        <button class="btn-warning btn text-white  btn-block" [routerLink]="['/crm/agreements']" title="Return to Agreement List">
                            <mat-icon>arrow_back</mat-icon> 
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <br> 
        <form [formGroup]="salesOrderForm" class="form-container">
            <div class="col-12"> 
                <div class="form-row">
                    <div class="row">
                        <div class="col-9">
                            <div class="row">
                                <div class="col-4">
                                    <mat-form-field class="full-width">
                                        <mat-label i18n="@@CMMContactsNameFormControl">Agreement Number</mat-label>
                                        <input matInput 
                                        #sono formControlName="voucherNo" 
                                        (keydown.f2)="lookupSalesorder(sono.value)"
                                        (keydown.enter)="getSalesorder(sono.value)" >
                                    </mat-form-field>
                                </div>
                                <div class="col-4">
                                    <mat-form-field class="full-width">
                                        <mat-label i18n="@@CMMContactsNameFormControl">Invoice Number</mat-label>
                                        <input matInput formControlName="invNbr">
                                    </mat-form-field>
                                </div>
                                <div class="col-4">
                                    <mat-form-field class="full-width"> 
                                        <mat-label i18n="@@CMMContactsMobileFormControl">Agreement Date</mat-label>
                                        <input type="text" formControlName="voucherDate" matInput>
                                        <mat-error i18n="@@CMMContactsMobileFormControlError">Agreement Date <strong>required</strong></mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <mat-form-field class="full-width"> 
                                        <mat-label i18n="@@CMMContactsMobileFormControl">Quotation No</mat-label>
                                        <input matInput type="text" formControlName="quotationNo" >
                                        <mat-error i18n="@@CMMContactsMobileFormControlError">Quotation No <strong>required</strong></mat-error>
                                    </mat-form-field> 
                                </div>
                                <div class="col-4">
                                    <mat-form-field class="full-width">
                                        <mat-label i18n="@@CMMContactsNameFormControl">Sales Order Number</mat-label>
                                        <input matInput formControlName="soNbr">
                                    </mat-form-field>
                                </div>
                                <div class="col-4">
                                    <mat-form-field class="full-width"> 
                                        <mat-label i18n="@@CMMContactsMobileFormControl">Customer Code</mat-label>
                                        <input type="text" formControlName="customerCode" matInput>
                                        <mat-error i18n="@@CMMContactsMobileFormControlError">Customer code <strong>required</strong></mat-error>
                                    </mat-form-field>                             
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <mat-form-field class="full-width"> 
                                        <mat-label i18n="@@CMMContactsMobileFormControl">Subject </mat-label>
                                        <input type="text" formControlName="subject" matInput>
                                        <mat-error i18n="@@CMMContactsMobileFormControlError">Subject <strong>required</strong></mat-error>
                                    </mat-form-field>
                                </div> 
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="row">
                                <div class="col-12">
                                    <mat-form-field class="full-width"> 
                                        <mat-label i18n="@@CMMContactsMobileFormControl">Contact Person</mat-label>
                                        <input matInput type="text" #contactPerson formControlName="party" 
                                        (keydown.f2)="lookUpParty(contactPerson.value)">
                                        <mat-error i18n="@@CMMContactsMobileFormControlError">Contact Person <strong>required</strong></mat-error>
                                    </mat-form-field>
                                </div>
                                <div class="col-12">
                                    <p><strong>{{ mPartyName }}</strong> <br> {{ mPartyAdd1 }}, {{ mPartyAdd2 }}, {{ mPartyAdd3 }} <br> {{ mPartyPhone }} / {{ mPartyTelephone}} <br> {{ mPartyEmail }}</p>
                                </div>
                            </div>
                        </div>  
                    </div>
                </div> 
                <hr>
            </div>
            <div class="col-12">
                <div class="col-12">
                    <div class="form-row">
                        <div class="col-12" style="height: 35vh; overflow-y: auto;" >
                            <table class="table table-borderless table-hover table-responsive-xxl" formArrayName="srvItemArr">
                                <thead>
                                    <tr class="table-reflow" style="background-color: rgb(2, 46, 82); color: white;">
                                        <th style="width: 5%;">Code</th>
                                        <!-- <th style="width: 7.5%;">Description </th> -->
                                        <th style="width: 5%;">Member</th>
                                        <th style="width: 18%;">Member Name</th>
                                        <th style="width: 12%;">From</th>
                                        <th style="width: 12%;">To</th>                                                                                                     
                                        <th style="width: 10%;">Value</th>
                                        <th style="width: 6%;">Disc %</th>
                                        <th style="width: 8%;">Discount</th>
                                        <!--<th style="width: 5%;">Gross</th> -->
                                        <th style="width: 6%;">VAT %</th>
                                        <th style="width: 8%;">VAT</th>
                                        <th style="width: 10%;">Gross</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody (keydown.alt.n)="addServiceItem()">
                                    <tr #rptItem *ngFor="let rp of srvItem?.controls; let i = index;" [formGroupName]="i" (keydown.alt.x)="deleteServiceItem(i)">
                                        <td>
                                            <input #itemCode class="form-control form-control-sm" type="text" formControlName="srvCode" (keydown.f2)="lookUpReference(i)" (change)="getRefData(itemCode.value,i)">
                                        </td>
                                        <!--
                                        <td>
                                            <textarea  class="form-control form-control-sm"  formControlName="srvDesc" >
                                            </textarea>
                                        </td>
                                        -->              
                                        <td>
                                            <input #membCode class="form-control form-control-sm" type="text" formControlName="srvMember" (keydown.f2)="lookUpMembers(membCode.value,i)" (change)="getMemberdata(membCode.value,i)">
                                        </td>
                                        <td>
                                            <textarea  class="form-control form-control-sm" formControlName="srvMemberName">
                                            </textarea>
                                        </td>
                                        <td>
                                            <input matInput [matDatepicker]="fromPicker" formControlName="srvFrom">
                                            <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
                                            <mat-datepicker #fromPicker></mat-datepicker>
                                            <!-- <input class="form-control form-control-sm" type="date" formControlName="srvFrom"> -->
                                        </td>
                                        <td>
                                            <input matInput [matDatepicker]="toPicker" formControlName="srvTo">
                                            <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
                                            <mat-datepicker #toPicker></mat-datepicker>
                                            <!-- <input class="form-control form-control-sm" 
                                            type="date" formControlName="srvTo"> -->
                                        </td>              
                                        <td>
                                            <input class="form-control form-control-sm" type="text" formControlName="srvValue" (keydown.f2)="lookupAgreementAndMember(i)" (focus)="captureGridIndex(i)">
                                        </td>
                                        <td>
                                            <input #disc class="form-control form-control-sm" type="text" formControlName="srvDisc" (change)="getdiscount(disc.value,i)">
                                        </td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" formControlName="srvDiscount">
                                        </td>
                                        <td>
                                            <mat-select formControlName="srvVatCat" (valueChange)="gettaxValue($event,i)" required>
                                                <mat-option *ngFor="let tax of taxArr" [value]="tax.TAX_1_PERC">
                                                    {{ tax.TAX_CATEGORY_NAME }}
                                                </mat-option>
                                            </mat-select>
                                        </td>
                                        <td>
                                            <input #pcode class="form-control form-control-sm" type="text" formControlName="srvVat">
                                        </td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" formControlName="srvNetValue">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger" type="button" (click)="deleteServiceItem(i)">&#10005;</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <button class="btn btn-success" type="button" (click)="addServiceItem()">&#43;</button>
                        </div>
                     </div>  
                </div>    
            </div>
            <hr>
            <div class="col-12">
                <div class="row">
                    <div class="col-8"></div>
                    <div class="col-4">
                        <div class="row">
                            <div class="col-6">
                                <h4 style="color: darkblue;">Total:</h4>
                                <h4 style="color: darkblue;">Discount:</h4>
                                <h4 style="color: darkblue;">VAT:</h4>
                                <hr>
                                <h3 style="color: darkblue;">Grand Total:</h3>
                            </div>                                    
                            <div class="col-6" style="float: right;">
                                <h4 style="color: darkblue;">BHD {{ mAgrTotal | number : '1.3' }}</h4>
                                <h4 style="color: darkblue;">BHD {{ mAgrDisc | number : '1.3'}}</h4>
                                <h4 style="color: darkblue;">BHD {{ mAgrVAT | number : '1.3'}}</h4>
                                <hr>
                                <h3 style="color: darkblue;">BHD {{ mAgrGTotal | number : '1.3'}}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <div class="col-12">
            <ng-template #partyLookupDialog 
            style="width: 60%;">
                <h3 matDialogTitle>
                    <b>Look up contacts: {{ partyArr.length }}</b>
                </h3>
                <hr>
                <div mat-dialog-content>
                    <table mat-table 
                    [dataSource]="partyDataSource" 
                    class="mat-elevation-z8" 
                    style="width: 65vw; height: 50vh;">
                        <ng-container matColumnDef="pcode">
                            <th mat-header-cell 
                            *matHeaderCellDef> PCODE </th>
                            <td mat-cell 
                            *matCellDef="let party"> {{ party.pcode }} </td>
                        </ng-container>
                        <ng-container matColumnDef="cust_name">
                            <th mat-header-cell 
                            *matHeaderCellDef> Customer Name </th>
                            <td mat-cell 
                            *matCellDef="let party"> {{ party.cust_name }} </td>
                        </ng-container>
                        <ng-container matColumnDef="party_id">
                            <th mat-header-cell 
                            *matHeaderCellDef> Contact ID </th>
                            <td mat-cell 
                            *matCellDef="let party"> {{ party.party_id }} </td>
                        </ng-container>
                        <ng-container matColumnDef="name">
                            <th mat-header-cell 
                            *matHeaderCellDef> Contact Name </th>
                            <td mat-cell 
                            *matCellDef="let party"> {{ party.name }} </td>
                        </ng-container>
                        <ng-container matColumnDef="add1">
                            <th mat-header-cell 
                            *matHeaderCellDef> Address 1 </th>
                            <td mat-cell 
                            *matCellDef="let party"> {{ party.add1 }} </td>
                        </ng-container>
                        <ng-container matColumnDef="add2">
                            <th mat-header-cell 
                            *matHeaderCellDef> Address 2 </th>
                            <td mat-cell 
                            *matCellDef="let party"> {{ party.add2 }} </td>
                        </ng-container>
                        <ng-container matColumnDef="add3">
                            <th mat-header-cell 
                            *matHeaderCellDef> Address 3 </th>
                            <td mat-cell 
                            *matCellDef="let party"> {{ party.add3 }} </td>
                        </ng-container>
                        <ng-container matColumnDef="phone1">
                            <th mat-header-cell 
                            *matHeaderCellDef> Phone number </th>
                            <td mat-cell 
                            *matCellDef="let party"> {{ party.phone1 }} </td>
                        </ng-container>
                        <ng-container matColumnDef="mobile">
                            <th mat-header-cell 
                            *matHeaderCellDef> Telephone </th>
                            <td mat-cell 
                            *matCellDef="let party"> {{ party.mobile }} </td>
                        </ng-container>
                        <ng-container matColumnDef="email_id">
                            <th mat-header-cell 
                            *matHeaderCellDef> Email </th>
                            <td mat-cell 
                            *matCellDef="let party"> {{ party.email_id }} </td>
                        </ng-container>
                        <tr mat-header-row 
                        *matHeaderRowDef="partyDisplayedColumns"></tr>
                        <tr mat-row 
                        *matRowDef="let row; columns: partyDisplayedColumns;  let i= index"
                        [ngClass]="{'highlight': selectedRowIndex == i}"
                        (click)="highlight('party',i)"
                        tabindex="999"
                        (keydown.arrowdown)="arrowDownEvent('party',selectedRowIndex)"
                        (keydown.arrowup)="arrowUpEvent('party',selectedRowIndex)" 
                        (keydown.enter)="selectParty(partyArr[selectedRowIndex])"></tr>
                    </table>
                </div>
                <mat-dialog-actions align="end">
                    <button mat-button 
                    matDialogClose="close">Close</button>
                </mat-dialog-actions>
            </ng-template>
        </div>

        <div class="col-12">
            <ng-template #SOLookUpDailouge style="width: 60%;">
                <h3 matDialogTitle>
                    <b>Look up for Sales Order: {{ SOArr.length }}</b>
                </h3>
                <hr>
                <!-- <mat-form-field >
                    <input matInput #input
                    (keyup)="applyFilter($event)" >
                </mat-form-field> --->
                <div mat-dialog-content>
                    <table mat-table 
                    [dataSource]="SalesOrderDataSource" 
                    class="mat-elevation-z8" 
                    style="width: 65vw; height: 50vh;">
                        <ng-container matColumnDef="sono">
                            <th mat-header-cell 
                            *matHeaderCellDef> Agreement Number </th>
                            <td mat-cell 
                            *matCellDef="let so"> {{ so.AGR_NO }} </td>
                        </ng-container>
                      
                        <ng-container matColumnDef="pcode">
                            <th mat-header-cell 
                            *matHeaderCellDef> Pcode </th>
                            <td mat-cell 
                            *matCellDef="let so"> {{ so.PCODE }} </td>
                        </ng-container>

                        <ng-container matColumnDef="custname">
                            <th mat-header-cell 
                            *matHeaderCellDef> Customer Name</th>
                            <td mat-cell 
                            *matCellDef="let so"> {{ so.CUST_NAME }} </td>
                        </ng-container>

                        <ng-container matColumnDef="total">
                            <th mat-header-cell 
                            *matHeaderCellDef> Total Amount</th>
                            <td mat-cell 
                            *matCellDef="let so"> {{ so.GTOTAL }} </td>
                        </ng-container>
                        <tr mat-header-row 
                        *matHeaderRowDef="SalesOrderDisplayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: SalesOrderDisplayedColumns;  let i= index" [ngClass]="{'highlight': selectedRowIndex == i}" (click)="highlight('salesorder',i)" tabindex="999" (keydown.arrowdown)="arrowDownEvent('salesorder',selectedRowIndex)"
                        (keydown.arrowup)="arrowUpEvent('salesorder',selectedRowIndex)" 
                        (keydown.enter)="selectSalesOrder(SOArr[selectedRowIndex])"></tr>
                    </table>
                </div>
                <mat-dialog-actions align="end">
                    <button mat-button matDialogClose="close">Close</button>
                </mat-dialog-actions>
            </ng-template>
        </div>

        <div class="col-12">
            <ng-template #agreementLookUpDialog 
            style="width: 80%;">
                <h3 matDialogTitle>
                    <b>Manage Services</b>
                </h3>
                <hr>
                <form [formGroup]="agreementForm" class="form-container">
                    <div class="col-12">
                        <div class="form-row">
                            <div class="col-12" 
                            style="height: 25vh; overflow-y: auto;" >
                                <table class="table table-borderless table-hover table-responsive-xxl"
                                formArrayName="serviceArr">
                                    <thead>
                                        <tr class="table-reflow" 
                                        style="background-color: rgb(2, 46, 82); color: white;">
                                            <th style="width: 30%;">Service No</th>
                                            <th style="width: 50%;">Service Description</th>
                                            <th style="width: 20%;">Price</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody (keydown.alt.n)="addAgreementItem()">
                                        <tr 
                                        #rptItem 
                                        *ngFor="let rp of agreementForm.controls.serviceArr.controls; let i = index;" 
                                        [formGroupName]="i" 
                                        (keydown.alt.x)="deleteAgreementItem(i)">
                                            <td>
                                                <input #serviceno
                                                class="form-control form-control-sm" 
                                                type="text" 
                                                formControlName="serviceNo" 
                                                (keydown.f2)="lookUpSrv(serviceno.value, i)"
                                                (keydown.enter)="getsrvData(serviceno.value,i)">
                                            </td>  
                                            <td>
                                                <input class="form-control form-control-sm" 
                                                type="text" 
                                                formControlName="serviceDesc" >
                                            </td>             
                                            <td>
                                                <input #pcode
                                                class="form-control form-control-sm" 
                                                type="text"
                                                formControlName="Price">
                                            </td>
                                            <td>
                                                <button class="btn btn-danger" 
                                                type="button" 
                                                (click)="deleteAgreementItem(i)">&#10005;</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <button class="btn btn-success" 
                                type="button" 
                                (click)="addAgreementItem(valueIndex)">&#43;</button>
                            </div>
                        </div>  
                    </div>   
                    <mat-dialog-actions align="end">
                        <button class="btn btn-primary" 
                        type="button" 
                        (click)="submitAgreement()">Submit</button>
                    </mat-dialog-actions>
                </form>
            </ng-template>
        </div>

        <div class="col-12">
            <div class="col-12">
                <ng-template #membLookupDialog 
                style="width: 60%;">
                    <h3 matDialogTitle>
                        <b>Look up Members: {{ membArr.length }}</b>
                    </h3>
                    <hr>
                    <div mat-dialog-content>
                        <table mat-table 
                        [dataSource]="membDataSource" 
                        class="mat-elevation-z8" 
                        style="width: 65vw; height: 50vh;">
                            <ng-container matColumnDef="memberNo">
                                <th mat-header-cell 
                                *matHeaderCellDef> Member Nbr </th>
                                <td mat-cell 
                                *matCellDef="let memb"> {{ memb.MemberNo }} </td>
                            </ng-container>
                            <ng-container matColumnDef="memberRefNo">
                                <th mat-header-cell 
                                *matHeaderCellDef> Reference Nbr </th>
                                <td mat-cell 
                                *matCellDef="let memb"> {{ memb.REFMEMBNO }} </td>
                            </ng-container>
                            <ng-container matColumnDef="title">
                                <th mat-header-cell 
                                *matHeaderCellDef> Title </th>
                                <td mat-cell 
                                *matCellDef="let memb"> {{ memb.TITLE }} </td>
                            </ng-container>
                            <ng-container matColumnDef="firstname">
                                <th mat-header-cell 
                                *matHeaderCellDef> Firstname </th>
                                <td mat-cell 
                                *matCellDef="let memb"> {{ memb.NAME }} </td>
                            </ng-container>
                            <ng-container matColumnDef="surname">
                                <th mat-header-cell 
                                *matHeaderCellDef> LName </th>
                                <td mat-cell 
                                *matCellDef="let memb"> {{ memb.SURNAME }} </td>
                            </ng-container>
                            <ng-container matColumnDef="cprno">
                                <th mat-header-cell 
                                *matHeaderCellDef> CPR Nbr </th>
                                <td mat-cell 
                                *matCellDef="let memb"> {{ memb.CPRNo }} </td>
                            </ng-container>
                            <tr mat-header-row 
                            *matHeaderRowDef="membDisplayedColumns"></tr>
                            <tr mat-row 
                            *matRowDef="let row; columns: membDisplayedColumns;  let i= index"
                            [ngClass]="{'highlight': selectedRowIndex == i}"
                            (click)="highlight('membs',i)"
                            tabindex="999"
                            (keydown.arrowdown)="arrowDownEvent('membs',selectedRowIndex)"
                            (keydown.arrowup)="arrowUpEvent('membs',selectedRowIndex)" 
                            (keydown.enter)="selectMember(membArr[selectedRowIndex])"></tr>
                        </table>
                    </div>
                    <mat-dialog-actions align="end">
                        <button mat-button 
                        matDialogClose="close">Close</button>
                    </mat-dialog-actions>
                </ng-template>
            </div>
        </div>

        <div class="col-12">
            <ng-template #sivLookupDialog 
            style="width: 60%;">
                <h3 matDialogTitle>
                    <b>Look up Service Number: {{ srvArr.length }}</b>
                </h3>
                <hr>
                <!-- <mat-form-field >
                <input matInput #input
                (keyup)="applyFilter($event)" >
                </mat-form-field> --->
                <div mat-dialog-content>
                    <table mat-table 
                    [dataSource]="serviceDataSouuce" 
                    class="mat-elevation-z8" 
                    style="width: 65vw; height: 50vh;">
                        <ng-container matColumnDef="ServiceID">
                            <th mat-header-cell 
                            *matHeaderCellDef> Service Nbr </th>
                            <td mat-cell 
                            *matCellDef="let srv"> {{ srv.ServiceID }} </td>
                        </ng-container>
                      
                        <ng-container matColumnDef="servicedesc">
                            <th mat-header-cell 
                            *matHeaderCellDef> Service Description</th>
                            <td mat-cell 
                            *matCellDef="let srv"> {{ srv.ServiceDescription }} </td>
                        </ng-container>

                        <ng-container matColumnDef="actualprice">
                            <th mat-header-cell 
                            *matHeaderCellDef> Actual Price </th>
                            <td mat-cell 
                            *matCellDef="let srv"> {{ srv.ActualPrice }} </td>
                        </ng-container>
                      
                        <ng-container matColumnDef="memberprice">
                            <th mat-header-cell 
                            *matHeaderCellDef> LName </th>
                            <td mat-cell 
                            *matCellDef="let srv"> {{ srv.MemberPrice }} </td>
                        </ng-container>
                  
                        <tr mat-header-row 
                        *matHeaderRowDef="serviceDisplayedColumns"></tr>
                        <tr mat-row 
                        *matRowDef="let row; columns: serviceDisplayedColumns;  let i= index"
                        [ngClass]="{'highlight': selectedRowIndex == i}"
                        (click)="highlight('srvs',i)"
                        tabindex="999"
                        (keydown.arrowdown)="arrowDownEvent('srvs',selectedRowIndex)"
                        (keydown.arrowup)="arrowUpEvent('srvs',selectedRowIndex)" 
                        (keydown.enter)="selectSiv()"></tr>
          
                        <!-- Row shown when there is no matching data. 
                        <tr class="mat-row" 
                        *matNoDataRow>
                          <td class="mat-cell" 
                          colspan="4">No data matching the filter "{{input.value}}"</td>
                        </tr> -->
                    </table>
                </div>
                <mat-dialog-actions align="end">
                    <button mat-button
                    matDialogClose="close">Close</button>
                </mat-dialog-actions>
            </ng-template>
        </div>

        <div class="col-12">
            <ng-template #RefLookupDialog 
            style="width: 60%;">
                <h3 matDialogTitle>
                    <b>Look up Reference Details: {{ refArr.length }}</b>
                </h3>
                <hr>
                <!-- <mat-form-field >
                <input matInput #input
                (keyup)="applyFilter($event)" >
                </mat-form-field> --->
                <div mat-dialog-content>
                    <table mat-table 
                    [dataSource]="referenceDataSouuce" 
                    class="mat-elevation-z8" 
                    style="width: 65vw; height: 50vh;">
                        <ng-container matColumnDef="refid">
                            <th mat-header-cell 
                            *matHeaderCellDef> Reference Code </th>
                            <td mat-cell 
                            *matCellDef="let ref"> {{ ref.PCODE }} </td>
                        </ng-container>
                      
                        <ng-container matColumnDef="name">
                            <th mat-header-cell 
                            *matHeaderCellDef> Reference Name </th>
                            <td mat-cell 
                            *matCellDef="let ref"> {{ ref.NAME }} </td>
                        </ng-container>

                        <ng-container matColumnDef="desc">
                            <th mat-header-cell 
                            *matHeaderCellDef> Description </th>
                            <td mat-cell 
                            *matCellDef="let ref"> {{ ref.DESCRIPTION }} </td>
                        </ng-container>
                      
                        <ng-container matColumnDef="type">
                            <th mat-header-cell 
                            *matHeaderCellDef> Type </th>
                            <td mat-cell 
                            *matCellDef="let ref"> {{ ref.TYPE }} </td>
                        </ng-container>
                  
                        <tr mat-header-row 
                        *matHeaderRowDef="referenceDisplayedColumns"></tr>
                        <tr mat-row 
                        *matRowDef="let row; columns: referenceDisplayedColumns;  let i= index"
                        [ngClass]="{'highlight': selectedRowIndex == i}"
                        (click)="highlight('ref',i)"
                        tabindex="999"
                        (keydown.arrowdown)="arrowDownEvent('ref',selectedRowIndex)"
                        (keydown.arrowup)="arrowUpEvent('ref',selectedRowIndex)" 
                        (keydown.enter)="selectRef(refArr[selectedRowIndex])"></tr>
          
                        <!-- Row shown when there is no matching data. 
                        <tr class="mat-row" 
                        *matNoDataRow>
                          <td class="mat-cell" 
                          colspan="4">No data matching the filter "{{input.value}}"</td>
                        </tr> -->
                    </table>
                </div>
                <mat-dialog-actions align="end">
                    <button mat-button
                    matDialogClose="close">Close</button>
                </mat-dialog-actions>
            </ng-template>
        </div>

        <div class="col-12">
            <ng-template #HelpDialog style="width: 100%;">
                <div mat-dialog-content>
                  <video width="100%">
                    <source src="https://ifaresort-images.s3.me-south-1.amazonaws.com/videos/agreement.mp4" type="video/mp4">
                  </video>
                </div>
                <mat-dialog-actions align="end">
                    <button mat-button matDialogClose="close">Close</button>
                </mat-dialog-actions>
            </ng-template>
        </div>
    </div>
</div>
